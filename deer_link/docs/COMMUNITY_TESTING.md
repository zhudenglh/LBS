# 社区功能测试文档

## 概述

本文档描述如何测试新实现的社区混合布局功能。

## 已实现的功能

### ✅ Phase 1: 双列瀑布流布局（已完成）

#### 1.1 核心组件
- **WaterfallGrid** - 双列瀑布流容器
- **WaterfallPostCard** - 瀑布流卡片
- **WaterfallSkeleton** - 加载骨架屏

#### 1.2 功能特性
- ✅ 双列布局自动平衡高度
- ✅ 卡片高度自适应
- ✅ 图片懒加载（FastImage）
- ✅ 点赞动画效果
- ✅ 下拉刷新
- ✅ 上拉加载更多
- ✅ 精华标识显示
- ✅ 车次标签显示

### ✅ Phase 2: 顶部导航 + 筛选器（已完成）

#### 2.1 核心组件
- **CommunityTabBar** - 顶部标签栏
- **FilterBar** - 筛选器栏

#### 2.2 功能特性
- ✅ 4 个 Tab：推荐、线路圈、附近的人、专题区
- ✅ 3 个筛选器：热门、最新、精华
- ✅ Tab 切换动画
- ✅ 筛选器样式切换

### ✅ Phase 3: 国际化（已完成）
- ✅ 中文翻译（zh.json）
- ✅ 英文翻译（en.json）
- ✅ 所有 UI 文本支持多语言

### ⏳ Phase 4: 待实现功能

#### 4.1 线路圈（Coming Soon）
- ⏳ 线路选择器
- ⏳ 在线用户横条
- ⏳ 站点打卡
- ⏳ 线路活动

#### 4.2 附近的人（Coming Soon）
- ⏳ 位置权限请求
- ⏳ 附近用户列表
- ⏳ 距离计算
- ⏳ 实时位置更新

#### 4.3 专题区（Coming Soon）
- ⏳ 论坛列表布局
- ⏳ 详情页（楼层结构）
- ⏳ 回复功能（楼中楼）
- ⏳ 富文本编辑器

---

## 如何测试

### 前置条件

1. **安装依赖**
```bash
npm install
```

2. **安装 iOS Pods（仅 macOS）**
```bash
cd ios && pod install && cd ..
```

3. **确保后端 API 可访问**
- 后端地址：`http://101.37.70.167:3000/api`
- 检查健康状态：`curl http://101.37.70.167:3000/health`

### 测试步骤

#### 1. 启动开发服务器

```bash
# 启动 Metro bundler
npm start
```

#### 2. 运行应用

**Android:**
```bash
npm run android
```

**iOS (仅 macOS):**
```bash
npm run ios
```

#### 3. 测试双列瀑布流

1. 打开应用后，点击底部 Tab 栏的 **🔍 发现**
2. 应该看到顶部有 4 个 Tab：推荐、线路圈、附近的人、专题区
3. 默认显示 **推荐** Tab
4. 应该看到筛选器：热门、最新、精华（默认选中"热门"）

**预期结果：**
- ✅ 双列布局，卡片高度自动平衡
- ✅ 每个卡片显示封面图、标题、内容预览、作者头像、点赞数
- ✅ 精华帖子右上角有"精华"标识
- ✅ 有车次标签的帖子底部显示标签（如"2路"）
- ✅ 卡片之间间距均匀（8px 列间距，12px 卡片间距）

#### 4. 测试交互功能

**点赞功能：**
1. 点击卡片底部的爱心图标
2. **预期：** 爱心从 🤍 变为 ❤️，数字 +1，颜色变蓝
3. 再次点击
4. **预期：** 爱心从 ❤️ 变为 🤍，数字 -1，颜色变灰

**卡片点击：**
1. 点击任意卡片
2. **预期：** 目前会在控制台输出 "Post pressed: {postId}"
3. 未来：进入帖子详情页

**下拉刷新：**
1. 在列表顶部下拉
2. **预期：** 显示加载指示器，重新加载数据
3. 加载完成后，列表回到顶部

**上拉加载更多：**
1. 滚动到列表底部
2. **预期：** 显示底部加载指示器，自动加载下一页数据
3. 新数据追加到列表末尾

#### 5. 测试筛选器

1. 点击 **最新** 筛选器
   - **预期：** 按钮变蓝色，重新加载数据（按时间排序）
2. 点击 **精华** 筛选器
   - **预期：** 按钮变蓝色，重新加载数据（只显示精华帖）

#### 6. 测试 Tab 切换

1. 点击 **线路圈** Tab
   - **预期：** 显示 "即将推出 - 线路圈"
2. 点击 **附近的人** Tab
   - **预期：** 显示 "即将推出 - 附近的人"
3. 点击 **专题区** Tab
   - **预期：** 显示 "即将推出 - 专题区"
4. 点击 **推荐** Tab
   - **预期：** 回到双列瀑布流

#### 7. 测试发布功能

1. 点击右下角的 **✏️** 按钮
2. **预期：** 弹出发布对话框
3. 输入标题、内容，选择车次
4. 点击发布
5. **预期：**
   - 发布成功后对话框关闭
   - 列表自动刷新
   - 新发布的帖子出现在列表中

#### 8. 测试骨架屏

1. 关闭应用，清除缓存
2. 重新打开应用，进入发现 Tab
3. **预期：**
   - 首次加载时显示骨架屏（灰色占位卡片）
   - 骨架屏有闪烁动画效果
   - 数据加载完成后，骨架屏消失，显示真实内容

#### 9. 测试国际化

**切换到英文：**
1. 进入 **我的** Tab
2. 点击 **设置** > **语言设置**
3. 选择 **English**
4. 返回发现 Tab
5. **预期：**
   - "推荐" 变为 "Recommend"
   - "热门" 变为 "Hot"
   - "赞" 变为 "Like"

---

## 测试检查清单

### UI/UX 测试
- [ ] 双列布局正常显示
- [ ] 卡片高度自动平衡
- [ ] 图片加载正常（无破图）
- [ ] 点赞动画流畅
- [ ] 下拉刷新正常
- [ ] 上拉加载更多正常
- [ ] 筛选器切换正常
- [ ] Tab 切换正常
- [ ] 骨架屏显示正常
- [ ] 精华标识显示正确
- [ ] 车次标签显示正确

### 功能测试
- [ ] 点赞/取消点赞功能正常
- [ ] 发布帖子功能正常
- [ ] 刷新加载最新数据
- [ ] 分页加载正常
- [ ] 筛选器过滤数据正确

### 性能测试
- [ ] 滚动流畅（无卡顿）
- [ ] 图片加载不阻塞 UI
- [ ] 快速切换 Tab 无崩溃
- [ ] 内存占用正常（< 150MB）

### 国际化测试
- [ ] 中文翻译完整
- [ ] 英文翻译完整
- [ ] 切换语言后 UI 更新

### 兼容性测试
- [ ] iOS 真机测试通过
- [ ] Android 真机测试通过
- [ ] 不同屏幕尺寸适配正常

---

## 常见问题排查

### 问题 1: 图片不显示
**原因：** FastImage 未正确安装或链接
**解决：**
```bash
# 重新安装依赖
rm -rf node_modules
npm install

# iOS 重新安装 pods
cd ios && pod install && cd ..

# 重新构建
npm run android:build-debug  # Android
npm run ios  # iOS
```

### 问题 2: 点赞后数据不更新
**原因：** 后端 API 不可用
**解决：**
```bash
# 检查后端连接
curl http://101.37.70.167:3000/health

# 检查网络日志
# Android: adb logcat | grep -i "network"
# iOS: 查看 Xcode Console
```

### 问题 3: 骨架屏一直显示
**原因：** API 请求失败或超时
**解决：**
1. 检查后端服务是否运行
2. 检查网络连接
3. 查看控制台错误日志

### 问题 4: 双列布局不平衡
**原因：** 卡片高度估算不准确
**解决：**
- 这是正常现象，因为使用的是估算高度
- 未来可以优化：后端返回图片尺寸，前端精确计算

### 问题 5: TypeScript 错误
**原因：** 导入路径或类型定义问题
**解决：**
```bash
# 运行类型检查
npm run tsc

# 如果有错误，检查导入语句是否正确
# 确保从 '@types' 而不是 '@types/community' 导入
```

---

## 性能基准

### 期望指标
- **首屏加载时间：** < 2 秒
- **滚动帧率：** > 55 FPS
- **内存占用：** < 150 MB
- **图片加载时间：** < 1 秒/张

### 性能优化已实施
- ✅ 虚拟滚动（只渲染可见区域）
- ✅ 图片懒加载（FastImage）
- ✅ 分页加载（每次 20 条）
- ✅ 防抖处理（滚动事件）
- ✅ 缓存策略（5 分钟）

---

## 下一步开发计划

### 优先级 P0（核心功能）
1. **帖子详情页** - 点击卡片后进入详情
2. **评论功能** - 支持评论和回复
3. **后端 API 对接** - 完整对接所有社区 API

### 优先级 P1（重要功能）
1. **线路圈功能** - 线路筛选、在线用户
2. **专题区功能** - 论坛模式、楼层结构
3. **附近的人功能** - 位置服务、距离计算

### 优先级 P2（优化）
1. **性能优化** - 进一步优化滚动性能
2. **图片预加载** - 智能预加载下一屏图片
3. **离线缓存** - 支持离线浏览已加载内容

---

## 反馈与报告 Bug

如果在测试过程中发现问题，请记录以下信息：

1. **设备信息**
   - 系统：iOS/Android
   - 版本：
   - 机型：

2. **复现步骤**
   - 详细步骤

3. **期望结果**
   - 应该发生什么

4. **实际结果**
   - 实际发生了什么

5. **截图/录屏**
   - 附上问题截图或录屏

6. **日志**
   - 控制台错误日志

---

## 总结

当前已实现的功能（Phase 1 + 2）已经可以正常使用和测试。后续的线路圈、附近的人、专题区功能将在后续阶段实现。

**当前完成度：**
- ✅ 双列瀑布流布局（100%）
- ✅ 顶部导航 + 筛选器（100%）
- ✅ 国际化（100%）
- ⏳ 线路圈（0%）
- ⏳ 附近的人（0%）
- ⏳ 专题区（0%）

**总体进度：** 约 50% 完成
